<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THDX Unwrap USDT0 ‚Üí gUSDT (v1.3.2)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1220;
      color: #e6edf3;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .card {
      background: #121a2a;
      padding: 25px;
      border-radius: 14px;
      border: 1px solid #2a3b52;
      width: min(380px, 90vw);
      text-align: center;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.4);
    }
    h2 { color: #7c5cff; margin-top: 0; }
    input, button {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      border-radius: 10px;
      font-size: 15px;
    }
    input {
      border: 1px solid #333;
      background: #0f1625;
      color: white;
    }
    button {
      border: 0;
      cursor: pointer;
      font-weight: 700;
      transition: 0.2s;
    }
    #connect {
      background: linear-gradient(90deg,#6ee7ff,#7c5cff);
      color: #000;
    }
    #unwrap {
      background: linear-gradient(90deg,#22c55e,#16a34a);
      color: #fff;
    }
    pre {
      background: #0f1625;
      color: #8ab4f8;
      padding: 10px;
      border-radius: 8px;
      text-align: left;
      white-space: pre-wrap;
      margin-top: 15px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>üíß THDX Unwrap USDT0 ‚Üí gUSDT</h2>
    <button id="connect">üîå Connect Wallet</button>
    <input id="amount" type="number" placeholder="Jumlah (contoh: 10)" />
    <button id="unwrap" disabled>üöÄ Unwrap Sekarang</button>
    <pre id="log">log siap...</pre>
  </div>

  <script>
    // === Konfigurasi ===
    const USDT0 = "0x78cf24370174180738c5b8e352b6d14c83a6c9a9".toLowerCase();
    const WRAPPER = "0xcab8f3ed8528655e0c2fad1c504c6cf eccf50b90".toLowerCase();
    const STABLE = {
      id: 2201,
      hex: "0x899",
      rpc: "https://stable-jsonrpc.testnet.chain0.dev",
      explorer: "https://blockscout.testnet.stable.xyz"
    };

    const log = (m) => {
      const el = document.getElementById("log");
      el.textContent += "\n" + m;
      el.scrollTop = el.scrollHeight;
      console.log(m);
    };

    let provider, signer, me;

    async function ensureStableNetwork() {
      const net = await provider.getNetwork();
      if (Number(net.chainId) === STABLE.id) return;
      try {
        await window.ethereum.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: STABLE.hex,
            chainName: "Stable Testnet",
            rpcUrls: [STABLE.rpc],
            blockExplorerUrls: [STABLE.explorer],
            nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 }
          }]
        });
        log("üåç Berhasil switch ke Stable Testnet ‚úÖ");
      } catch (e) {
        log("‚ö†Ô∏è Gagal ganti network: " + e.message);
      }
    }

    async function connect() {
      try {
        if (!window.ethereum) return log("‚ùå Tidak ada wallet. Gunakan MetaMask/OKX.");
        provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        me = await signer.getAddress();
        const net = await provider.getNetwork();

        log(`‚úÖ Connected: ${me}\nChain: ${net.chainId}`);
        await ensureStableNetwork();

        document.getElementById("unwrap").disabled = false;
      } catch (e) {
        log("‚ùå Connect error: " + (e.message || e));
      }
    }

    async function unwrapNow() {
      try {
        const amount = document.getElementById("amount").value.trim();
        if (!amount) return alert("Isi jumlah dulu (mis. 10)");
        const amtLD = ethers.utils.parseUnits(amount, 6);

        const erc20 = new ethers.Contract(USDT0, [
          "function approve(address,uint256) returns (bool)",
          "function balanceOf(address) view returns (uint256)"
        ], signer);

        const balance = await erc20.balanceOf(me);
        if (balance.lt(amtLD)) return log("‚ùå Saldo USDT0 tidak cukup.");

        log(`üßæ Approving ${amount} USDT0 ke ${WRAPPER} ...`);
        const txA = await erc20.approve(WRAPPER, amtLD);
        log(`‚è≥ TX Approve: ${txA.hash}`);
        await txA.wait();
        log("‚úÖ Approve sukses!");

        const wrapper = new ethers.Contract(WRAPPER, ["function depositTo(address,uint256) external"], signer);
        const txB = await wrapper.depositTo(me, amtLD);
        log(`üöÄ Unwrap TX: ${txB.hash}`);
        await txB.wait();
        log("‚úÖ USDT0 sukses diubah jadi gUSDT üéâ");
      } catch (e) {
        log("‚ùå Error: " + (e.data?.message || e.message || e));
      }
    }

    document.getElementById("connect").onclick = connect;
    document.getElementById("unwrap").onclick = unwrapNow;
  </script>
</body>
</html>
